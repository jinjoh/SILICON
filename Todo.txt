template matching:

- Use threading when matching multiple templates (batch mode). This
  should improve performance on multi core processors. (Function add_gate() is
  a critical section.
